auth_enabled: false

# ==================================================================================================================== #
# Серверные настройки                                                                                                  #
# ==================================================================================================================== #
server:
  http_listen_port: 3100                      # HTTP API порт для приёма логов и запросов от Grafana.
  grpc_listen_port: 9096                      # gRPC порт для внутреннего взаимодействия компонентов Loki.

# ==================================================================================================================== #
# Общие настройки для всех компонентов                                                                                 #
# ==================================================================================================================== #
common:
  path_prefix: /loki                          # Базовая директория для временных файлов (индексы, кэш). Данные исчезнут при перезапуске контейнера. Для persistence надо добавить volume.
  replication_factor: 1                       # Фактор репликации (1 = single-node, ≥3 для кластера).
  ring:
    kvstore:
      store: inmemory                         # Хранилище координации инстансов. Используйте 'inmemory' только для single-node. Для кластера нужен 'consul', 'etcd' или 'memberlist'.

# ==================================================================================================================== #
# Конфигурация схемы                                                                                                   #
# ==================================================================================================================== #
schema_config:
  configs:
    - from: 2026-02-12                        # Дата активации этой конфигурации (должна быть ≤ текущей дате).
      store: tsdb                             # Современное хранилище индексов.
      object_store: filesystem                # Где хранить объекты (логи). Backend для хранения объектов: filesystem (хранение логов на диске), s3, gcs, azure.
      schema: v13                             # Версия схемы (v13 - актуальная для TSDB)
      index:
        prefix: loki_index_                   # Префикс для файлов индекса (лучше использовать уникальный префикс)
        period: 24h                           # Период ротации индексных файлов

# ==================================================================================================================== #
# Настройки хранилища                                                                                                  #
# ==================================================================================================================== #
storage_config:
  filesystem:
    directory: /loki/chunks                   # Директория для хранения чанков логов
  tsdb_shipper:
    active_index_directory: /loki/tsdb-active # Директория для активных TSDB индексов
    cache_location: /loki/tsdb-cache          # Кэш для TSDB индексов
    cache_ttl: 72h                            # Время жизни кэша индексов

# ==================================================================================================================== #
# Ограничения ресурсов и политика хранения                                                                             #
# ==================================================================================================================== #
limits_config:
  query_timeout: 5m                           # Глобальный таймаут для всех запросов

  # Ограничения для запросов
  max_query_length: 24h                       # Максимальный временной диапазон одного запроса
  max_query_parallelism: 8                    # Максимальное количество параллельных подзапросов

  # Ограничения для ingestion (приёма логов)
  ingestion_rate_mb: 10                       # Максимальная скорость ingestion в MB/сек на tenant
  ingestion_burst_size_mb: 20                 # Максимальный burst размер для ingestion

  # Ограничения для чанков
  max_entries_limit_per_query: 5000           # Максимальное количество записей, возвращаемых одним запросом

  # Политика хранения (retention)
  retention_period: 720h                      # Время хранения логов (720h = 30 дней). Работает только с объектным хранилищем (S3/GCS), не с filesystem!

# ==================================================================================================================== #
# Компактор (опционально, но рекомендуется, чтобы объединять мелкие индексы)                                           #
# ==================================================================================================================== #
compactor:
  working_directory: /loki/compactor          # Временная директория для работы компактора
  shared_store: filesystem                    # Backend для хранения скомпактированных индексов
